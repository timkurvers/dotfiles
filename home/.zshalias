# Bundler
alias b='bundle exec '

# Python virtual environments
alias av='source .virtualenv/bin/activate &> /dev/null; source ../.virtualenv/bin/activate &> /dev/null; source ../../.virtualenv/bin/activate &> /dev/null'
alias dv='deactivate'

# Miscellaneous
alias crlf='find . -not -type d -exec file "{}" ";" | grep CRLF'
alias dnsflush='sudo killall -HUP mDNSResponder'
alias ndenv='nodenv'
alias serve='python -m SimpleHTTPServer'
alias simulator='open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app'

random() {
  local length
  let "length = ${1:=32} / 2"
  openssl rand -hex $length
}

reload() {
  source ~/.zshalias
}

socketpolicyd() {
  while true; do
    echo '<?xml version="1.0"?>
  <cross-domain-policy>
    <allow-access-from domain="*" />
  </cross-domain-policy>' | sudo nc -l 843;
  done
}

testsocketpolicy() {
  local host=$1
  local port
  let "port = ${2:=843}"

  echo "Testing: ${host}:${port}"
  echo
  python -c 'print "<policy-file-request/>%c" % 0' | nc $host $port
  echo
}

update() {
  homesick pull --all
  antigen selfupdate
  antigen update
  brew update
}

video2gif() {
  ffmpeg -y -i "${1}" -vf fps=${3:-10},scale=${2:-640}:-1:flags=lanczos,palettegen "${1}.png"
  ffmpeg -i "${1}" -i "${1}.png" -filter_complex "fps=${3:-10},scale=${2:-640}:-1:flags=lanczos[x];[x][1:v]paletteuse" "${1}".gif
  rm "${1}.png"
}
